From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Etil <81570777+etil2jz@users.noreply.github.com>
Date: Sun, 19 Dec 2021 22:34:04 +0100
Subject: [PATCH] Skip event if no listeners

Original code by Titaniumtown, licensed under GNU General Public License v3.0
You can find the original code on https://gitlab.com/Titaniumtown/JettPack

diff --git a/build.gradle.kts b/build.gradle.kts
index 1d5e05ab5c3c2ba206f52e8743163663490861ab..7e3eb41269da9ba5998877eef56831f0b1823b6b 100644
--- a/build.gradle.kts
+++ b/build.gradle.kts
@@ -26,9 +26,9 @@ dependencies {
     // api dependencies are listed transitively to API consumers
     api("commons-lang:commons-lang:2.6")
     api("com.google.guava:guava:31.0.1-jre")
-    api("com.google.code.gson:gson:2.8.8")
+    api("com.google.code.gson:gson:2.8.9")
     api("net.md-5:bungeecord-chat:1.16-R0.4")
-    api("org.yaml:snakeyaml:1.28")
+    api("org.yaml:snakeyaml:1.29")
     // Paper start
     api("com.googlecode.json-simple:json-simple:1.1.1") {
         isTransitive = false // includes junit
diff --git a/src/main/java/org/bukkit/plugin/SimplePluginManager.java b/src/main/java/org/bukkit/plugin/SimplePluginManager.java
index bb60356395ef81bd3bbc51ea1e4ca2faaca2bd1b..9813932164ecadbb5889d5d26bdd3a9947436f48 100644
--- a/src/main/java/org/bukkit/plugin/SimplePluginManager.java
+++ b/src/main/java/org/bukkit/plugin/SimplePluginManager.java
@@ -611,6 +611,13 @@ public final class SimplePluginManager implements PluginManager {
      */
     @Override
     public void callEvent(@NotNull Event event) {
+        // JettPack start
+        HandlerList handlers = event.getHandlers();
+        RegisteredListener[] listeners = handlers.getRegisteredListeners();
+        if (listeners.length == 0) {
+            return;
+        }
+        // JettPack end
         // Paper - replace callEvent by merging to below method
         // KTP start - optimize spigot event bus
         final boolean isAsync = event.isAsynchronous();
@@ -622,8 +629,8 @@ public final class SimplePluginManager implements PluginManager {
         }
         // KTP end - optimize spigot event bus
 
-        HandlerList handlers = event.getHandlers();
-        RegisteredListener[] listeners = handlers.getRegisteredListeners();
+        //HandlerList handlers = event.getHandlers();
+        //RegisteredListener[] listeners = handlers.getRegisteredListeners();
 
         for (RegisteredListener registration : listeners) {
             if (!registration.getPlugin().isEnabled()) {
