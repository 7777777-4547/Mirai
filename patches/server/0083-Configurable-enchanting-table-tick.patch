From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ivan Pekov <ivan@mrivanplays.com>
Date: Wed, 23 Dec 2020 08:42:18 +0200
Subject: [PATCH] Configurable enchanting table tick

Original code by YatopiaMC, licensed under MIT
You can find the original code on https://github.com/YatopiaMC/Yatopia

diff --git a/src/main/java/net/minecraft/world/level/block/entity/BeehiveBlockEntity.java b/src/main/java/net/minecraft/world/level/block/entity/BeehiveBlockEntity.java
index 8eabe7113822d35ff53390e981ea69ad5f07d67d..abf277f292aff6e5d940de185c629811c083901a 100644
--- a/src/main/java/net/minecraft/world/level/block/entity/BeehiveBlockEntity.java
+++ b/src/main/java/net/minecraft/world/level/block/entity/BeehiveBlockEntity.java
@@ -342,7 +342,8 @@ public class BeehiveBlockEntity extends BlockEntity {
 
     }
 
-    public static void serverTick(Level world, BlockPos pos, BlockState state, BeehiveBlockEntity blockEntity) {
+    public void serverTick(Level world, BlockPos pos, BlockState state, BeehiveBlockEntity blockEntity) {
+        if (this.stored.size() == 0) return; // Yatopia - TE optimizations
         BeehiveBlockEntity.tickOccupants(world, pos, state, blockEntity.stored, blockEntity.savedFlowerPos);
         if (!blockEntity.stored.isEmpty() && world.getRandom().nextDouble() < 0.005D) {
             double d0 = (double) pos.getX() + 0.5D;
diff --git a/src/main/java/net/minecraft/world/level/block/entity/EnchantmentTableBlockEntity.java b/src/main/java/net/minecraft/world/level/block/entity/EnchantmentTableBlockEntity.java
index b03621ebd0a94ab2dceb9006aee43fd5320094e3..7afa4bd52d3816ffd5eba1afeec26abb0d298eaa 100644
--- a/src/main/java/net/minecraft/world/level/block/entity/EnchantmentTableBlockEntity.java
+++ b/src/main/java/net/minecraft/world/level/block/entity/EnchantmentTableBlockEntity.java
@@ -49,6 +49,7 @@ public class EnchantmentTableBlockEntity extends BlockEntity implements Nameable
     }
 
     public static void bookAnimationTick(Level world, BlockPos pos, BlockState state, EnchantmentTableBlockEntity blockEntity) {
+        if (!wtf.etil.mirai.MiraiConfig.shouldTickEnchantingTables) return; // Yatopia - TE optimizations
         blockEntity.oOpen = blockEntity.open;
         blockEntity.oRot = blockEntity.rot;
         Player player = world.getNearestPlayer((double)pos.getX() + 0.5D, (double)pos.getY() + 0.5D, (double)pos.getZ() + 0.5D, 3.0D, false);
diff --git a/src/main/java/wtf/etil/mirai/MiraiConfig.java b/src/main/java/wtf/etil/mirai/MiraiConfig.java
index b5e0254f043e2d25bcbb98885558c117e2c72c44..55a16321d86d7b0c149f799d8f16404455bb30d5 100644
--- a/src/main/java/wtf/etil/mirai/MiraiConfig.java
+++ b/src/main/java/wtf/etil/mirai/MiraiConfig.java
@@ -247,4 +247,9 @@ public class MiraiConfig {
         alternateCurrent = getBoolean("enable-alternate-current", alternateCurrent);
     }
 
+    public static boolean shouldTickEnchantingTables = false;
+    private static void tickEnchantingTables() {
+        shouldTickEnchantingTables = getBoolean("tick-enchanting-tables", shouldTickEnchantingTables);
+    }
+
 }
\ No newline at end of file
